
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
<head><meta name="description" content="This process is used when you want to remove a storage system/VSA node from a cluster/management group for maintenance, using HPE StoreVirtual Management Console (CMC). After maintenance, the VSA node ..."></meta><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><meta name="DC.Type" content="topic"></meta><meta name="DC.Title" content="HPE Helion OpenStack 2.0: Removing a VSA Node For Maintenance"></meta><meta name="prodname" content="HPE Helion"></meta><meta name="version" content="4.1.0"></meta><meta name="copyright" content="HPE Helion 2015" type="primary"></meta><meta name="DC.Rights.Owner" content="HPE Helion 2015" type="primary"></meta><meta name="DC.Format" content="XHTML"></meta><meta name="DC.Identifier" content="topic_e32_tm2_rt"></meta><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>HPE Helion OpenStack 2.0: Removing a VSA Node For Maintenance</title><!--  Generated with Oxygen version 17.0, build number 2015072912.  --><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../../oxygen-webhelp/resources/skins/skin.css"><!----></link><script type="text/javascript"><!--
          
          var prefix = "../../../index.html";
          
          --></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-1.8.2.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="topic_e32_tm2_rt">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><a href="javascript:window.print();" title="Print this page"></a></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td width="75%"></td><td><div class="navheader"></div></td></tr></tbody></table>

  <h1 class="title topictitle1">HPE Helion OpenStack<sup>Â®</sup> 2.0: Removing a VSA Node For Maintenance</h1>

  <div class="body">
    
    <div class="section" id="topic_e32_tm2_rt__about">
      <p class="p">This process is used when you want to remove a storage system/VSA node from a
        cluster/management group for maintenance, using HPE StoreVirtual Management Console
        (CMC).</p>

      <p class="p">After maintenance, the VSA node is added back to the cluster.</p>

      <div class="p"><div class="cautiontitle">CAUTION:</div><div class="note caution">
          <ul class="ul" id="topic_e32_tm2_rt__ul_a2n_kp2_rt">
            <li class="li">To have the volumes available even after the VSA storage node goes offline, you must
              ensure that the VSA network RAID configuration/data protection aspects are taken care
              of prior to removing a VSA node. </li>

            <li class="li">See <em class="ph i">Using disk RAID with Network RAID in a cluster</em>, <em class="ph i">Planning the RAID
                configuration</em>, and the <em class="ph i">Data protection</em> sections of HPE StoreVirtual
              Storage Online help (available in <strong class="ph b">StoreVirtual Management Console</strong>) before
              configuring RAID. You must configure RAID before adding the storage system to the
              management group. Refer the online help of <strong class="ph b">HPE StoreVirtual CMC for configuring the
                network RAID for storage systems.</strong>
            </li>

            <li class="li">You must set the data protection level while creating the volume type for the VSA
              volumes in OpenStack Cinder.</li>

          </ul>

        </div>
</div>

      <p class="p">Use this process to remove a storage system/VSA node from a cluster/management group for
        maintenance using the HPE StoreVirtual Management Console (CMC). After maintenance, the VSA
        node is added back to the cluster.</p>

      <div class="p"><div class="cautiontitle">CAUTION:</div><div class="note caution">To make the volumes available even after the VSA storage node goes
          offline, you must ensure that the VSA network RAID configuration/data protection aspects
          are configured properly prior to removing a VSA node. <ul class="ul">
            <li class="li">To configure RAID, see the "Using disk RAID with Network RAID in a cluster,"
              "Planning the RAID configuration," and "Data protection" sections of the HP
              StoreVirtual Storage Online help (available in the <strong class="ph b">StoreVirtual Management
                Console</strong>). You must configure RAID before adding the storage system to the
              management group. Refer the online help of <strong class="ph b">HPE StoreVirtual CMC for configuring the
                network RAID for storage systems.</strong></li>

            <li class="li">You must set the data protection level while creating the volume type for the VSA
              volumes in OpenStack Cinder. For instructions, see the OpenStack configuration guide
                <a class="xref" href="http://docs.openstack.org/kilo/config-reference/content/HP-LeftHand-StoreVirtual-driver.html" target="_blank">HPE LeftHand/StoreVirtual driver</a>.</li>

          </ul>
</div>
</div>

    </div>

    <div class="section"><h2 class="title sectiontitle">Removing VSA Storage System for maintenance</h2>
      
      <p class="p">Perform the following steps to remove the VSA storage system for maintenance:</p>

      <ol class="ol">
        <li class="li">Review the <em class="ph i">Determining volume and snapshot availability</em> section in <strong class="ph b">HP
            StoreVirtual Storage Online help</strong> and ensure that the volume is available if the
          storage system/VSA node that is planned for maintenance goes offline.</li>

        <li class="li">If the repair option is available for the VSA storage system, choose the appropriate
          option in repair. For more information, see: <em class="ph i">Using Repair Storage System</em> in <strong class="ph b"> HP
            StoreVirtual Storage Online help in CMC.</strong><p class="p">OR</p>
<p class="p">If the repair option is
            unavailable, perform either of the operations below to remove the VSA storage system for
            maintenance:</p>

          <p class="p">See the <em class="ph i"> Maintaining storage systems in clusters</em> section in HPE StoreVirtual
            Storage Online help in CMC and perform any of the following operations to ensure that
            the cluster functions normally and the volumes continue to be available even after the
            storage system is removed/replaced:</p>
</li>

      </ol>

    </div>

    <div class="section"><h2 class="title sectiontitle">To Remove a VSA Storage System for Maintenance</h2>
      
      <p class="p">Perform the following steps to remove a VSA storage system for maintenance:</p>

      <ol class="ol">
        <li class="li">Ensure that the volume is available if the storage system/VSA node to be removed goes
          offline. For instructions, see the "Determining volume and snapshot availability" section
          in the <strong class="ph b">HPE StoreVirtual Storage Online help</strong>.</li>

        <li class="li">If the repair option is available for the VSA storage system, choose the appropriate
          option in repair. For instructions, see the "Using Repair Storage System" section in the
            <strong class="ph b">HPE StoreVirtual Storage Online help in CMC</strong>.<p class="p">OR</p>
<p class="p">If the repair option is
            unavailable, perform either of the below steps to remove the VSA storage system for
            maintenance:</p>
<p class="p">Perform any of the below operations to ensure that the cluster
            functions normally and the volumes continue to be available even after the storage
            system is removed/replaced. (For instructions see "Maintaining storage systems in
            clusters" section in the <strong class="ph b">HPE StoreVirtual Storage Online help in CMC</strong>).</p>
<div class="p">
            <ul class="ul" id="topic_e32_tm2_rt__ul_dmj_sq2_rt">
              <li class="li">Add and remove storage systems for an existing cluster (the new storage system
                from the list of available VSA storage systems as shown in CMC). </li>

              <li class="li">Exchange a storage system in a cluster. </li>

              <li class="li">Remove a storage system from a cluster (provided the remaining storage system is
                sufficient for the data availability: a minimum of 3 nodes should be available after
                the remove operation). Once the maintenance is done, the storage system may be added
                back to the cluster. Follow the instructions for <strong class="ph b">"Adding a storage system to a
                  cluster"</strong> to add the VSA storage system back to the cluster.</li>

            </ul>

          </div>
</li>

      </ol>

      <div class="p">
        <div class="note important"><span class="importanttitle">Important:</span> While removing VSA storage system permanently, the operator needs to
          ensure there is an odd number of managers running to avoid split brain syndrome. For
          example, if there are five nodes and one node is getting removed the operator needs to
          stop the manager running on any of the remaining four nodes.</div>

      </div>

    </div>

    <div class="section"><h2 class="title sectiontitle">Exclude the VSA node that's offline (removed for maintenance purposes) for further
        reconfiguration/updates until it's back online</h2>
      
      <p class="p">Even after the removal of a VSA node, it should continue to remain in the
          <samp class="ph codeph">~/helion/my_cloud/definitiondata/servers.yml</samp> file. It is also recommended
        to create a sufficient for the data availability, a minimum of three nodes should be
        available after the remove operation). Once the maintenance is done, the storage system may
        be added back to the cluster. For instructions, see the "Adding a storage system to a
        cluster" section.</p>

    </div>

    <div class="p">
      <div class="note important"><span class="importanttitle">Important:</span> While removing a VSA storage system permanently, the operator needs to
        ensure there is an odd number of managers running to avoid split brain syndrome. For
        example, if there are five nodes, and one node is getting removed, the operator needs to
        stop the manager running on any of the remaining four nodes</div>

    </div>

    <div class="section"><h2 class="title sectiontitle"><strong class="ph b">To exclude the VSA node that's offline for further reconfiguration/updates until
          it's back online</strong></h2>
      
      <p class="p">Even after the removable of a VSA node, it should continue to remain in the
          <samp class="ph codeph">data/servers.yml</samp> file. You should also create a
          <samp class="ph codeph">servers.yml</samp> file on the deployer/lifecycle-manager node with a list of
        VSA nodes that are currently offline, so that these nodes get excluded from any further
        reconfiguration or upgrades. This prevents a VSA node that is offline from being included in
        deployments.</p>

      <div class="p">Perform the following steps to remove the VSA node for maintenance:<ol class="ol">
          <li class="li">Login to the deployer/lifecycle-manager node.</li>

          <li class="li">Verify the node that needs to be kept under maintenance from
              <samp class="ph codeph">hosts/verb_hosts</samp>
            file:<pre class="pre codeblock">cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts</pre>
</li>

          <li class="li">Create a file (for example: @offline-vsa) and enter the node information that needs to
            be placed under maintenance. If, for example, you want to place
              <samp class="ph codeph">padawan-ccp-vsa001</samp> under maintenance, you must use the host name
            along with ! and * (for example: <samp class="ph codeph">!padawan-ccp-vsa001*</samp>)</li>

          <li class="li">Execute the following
              command:<pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit &lt;hostname&gt;</pre>
<div class="p">In
              the following example <strong class="ph b">offline-vsa</strong> file is created with the VSA host
              name:<pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit @offline-vsa</pre>
</div>
<p class="p">The
              node which is included in the offline-vsa is placed under maintenance.</p>
</li>

          <li class="li">Run the following
              command:<pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts site.yml --limit &lt;hostname&gt;</pre>
<p class="p">For
              example:</p>
<pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts site.yml --limit @offline-vsa</pre>
<p class="p">When
              performing Helion lifecycle management deployments, specify the name of this file in a
              --limit option to prevent the deployment process trying to access the VSA nodes that
              are offline.</p>
</li>

        </ol>
</div>

      <div class="p">Perform the following steps to remove the VSA node for maintenance.<ol class="ol">
          <li class="li">Login to the Deployer/lifecycle-manager node.</li>

          <li class="li">Verify that the node that needs to be kept under maintenance from
              <samp class="ph codeph">hosts/verb_hosts</samp>
            file:<pre class="pre codeblock">cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts</pre>
</li>

          <li class="li">Create a file (for example, @offline-vsa) and enter the node information that needs to
            be placed under maintenance. For example, if you want to place
              <samp class="ph codeph">padawan-ccp-vsa001</samp> under maintenance, then you must use the host name
            along with ! and * (i.e., <samp class="ph codeph">!padawan-ccp-vsa001*</samp>).</li>

          <li class="li">Execute the following
              command:<pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit &lt;hostname&gt;</pre>
<div class="p">In
              the following example, <strong class="ph b">offline-vsa</strong> file is created with the VSA host name:
              <pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts osconfig-run.yml --limit @offline-vsa</pre>
</div>
<p class="p">The
              node which is included in the offline-vsa is placed under maintenance.</p>
</li>

          <li class="li">Run the following command:
              <pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts site.yml --limit &lt;hostname&gt;</pre>
<p class="p">For
              example:</p>
<pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts site.yml --limit @offline-vsa</pre>
<p class="p">When
              performing Helion lifecycle management, deployments specify the name of this file in a
                <samp class="ph codeph">--limit</samp> option to prevent the deployment process trying to access
              the VSA nodes that are offline.</p>
</li>

        </ol>
</div>

    </div>

  </div>

<div class="navfooter"><!----></div><div class="footer">WebHelp output generated by<a class="oxyFooter" href="http://www.oxygenxml.com" target="_blank"><span class="oXygenLogo"><img src="../../../oxygen-webhelp/resources/img/LogoOxygen100x22.png" alt="Oxygen"></img></span><span class="xmlauthor">XML Author</span></a></div>
</body>
</html>