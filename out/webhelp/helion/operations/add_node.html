
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
<head><meta name="description" content="To add a new compute node to your cloud, you will need to add it to the servers.yml file and then run the playbooks that update your cloud configuration. Note that to run any playbooks whatsoever for ..."></meta><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><meta name="DC.Type" content="topic"></meta><meta name="DC.Title" content="HPE Helion OpenStack 2.0: Adding a Compute Node"></meta><meta name="prodname" content="HPE Helion"></meta><meta name="version" content="4.1.0"></meta><meta name="copyright" content="HPE Helion 2015" type="primary"></meta><meta name="DC.Rights.Owner" content="HPE Helion 2015" type="primary"></meta><meta name="DC.Format" content="XHTML"></meta><meta name="DC.Identifier" content="topic_qsv_h5y_lt"></meta><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>HPE Helion OpenStack 2.0: Adding a Compute Node</title><!--  Generated with Oxygen version 17.0, build number 2015072912.  --><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/resources/skins/skin.css"><!----></link><script type="text/javascript"><!--
          
          var prefix = "../../index.html";
          
          --></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery-1.8.2.min.js"><!----></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="topic_qsv_h5y_lt">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><a href="javascript:window.print();" title="Print this page"></a></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td width="75%"></td><td><div class="navheader"></div></td></tr></tbody></table>

  <h1 class="title topictitle1">HPE Helion OpenStack<sup>Â®</sup> 2.0: Adding a Compute Node</h1>

  <div class="body">
    <div class="section"> To add a new compute node to your cloud, you will need to add it to the
        <strong class="ph b">servers.yml</strong> file and then run the playbooks that update your cloud configuration.
      Note that to run any playbooks whatsoever for cloud maintenance, you will always run them from
      the deployer/lifecycle-manager node.</div>

    <div class="section">To begin, access the <strong class="ph b">servers.yml</strong> file by checking out the git branch where you
      are required to make the changes: <ol class="ol" id="topic_qsv_h5y_lt__ol_bw1_rg5_tt">
        <li class="li">Get the <strong class="ph b">servers.yml</strong> file stored in
          git:<pre class="pre codeblock">cd ~/helion/my_cloud/definition/data
git checkout site</pre>
 Add
          details of new node(s) to <strong class="ph b">severs.yml</strong>. For example, if adding new server
            <samp class="ph codeph">compute7</samp> in <strong class="ph b">servers.yml
          </strong><pre class="pre codeblock">---
  product:
    version: 2  

  baremetal:
    # NOTE: These values need to be changed to match your environment.
    # Define the network range that contains the ip-addr values for
    # the individual servers listed below.
    subnet: 192.168.10.0
    netmask: 255.255.255.0

  servers:
    # NOTE: Addresses of servers need to be changed to match your environment.
    #
    # Add additional servers as required
    #
     
     ... 
    # Compute Nodes
    - id: compute7
      ip-addr: 192.168.10.13
      role: COMPUTE-ROLE
      server-group: RACK1
      nic-mapping: nic-mapping: HP_DL360_6PORT
      mac-addr: d6:70:c1:36:43:f7
      ilo_ip: "10.1.8.24"
      ilo_user: "admin"
      ilo_password: "whatever"</pre>

        </li>

        <li class="li"> Commit the changes <pre class="pre codeblock">git commit -a -m "Add node &lt;name&gt;"</pre>
 Then
          run the configuration processor and the ready deployment
          playbooks:<pre class="pre codeblock">cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml</pre>

        </li>

        <li class="li">Now configure the new node(s)
            <pre class="pre codeblock">ansible-playbook -i hosts/localhost cobbler-deploy.yml
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=compute7</pre>
<strong class="ph b"> </strong>Before proceeding, you may want to take a look at <strong class="ph b">info/server_info.yml</strong> to see
          if the assignment of the node you have added is what you expect. It may not be, as nodes
          will not be numbered consecutively if any have previously been removed. This is to prevent
          loss of data; the config processor retains data about removed nodes and keeps their ID
          numbers from being reallocated. See the <span class="ph" id="topic_qsv_h5y_lt___Toc432693223">Persisted Server
            Allocations</span> section in <a class="xref" href="../input_model.html#input_model">HPE Helion
            OpenStack 2.0 Input Model</a> for information on how this works.</li>

        <li class="li">Run the following deployment step specifying the '--limit' option to apply the
          deployment actions only to the target node(s).
          <pre class="pre codeblock">cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts site.yml --limit hlm004-ccp-comp0007*</pre>
</li>

        <li class="li">If you want the new compute node to be included in the monitoring service checks, there
          is an additional playbook that must be run to ensure this happens:
          <pre class="pre codeblock">cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts monasca-deploy.yml --tags active_ping_checks</pre>
</li>

      </ol>

    </div>


    <div class="section"><h2 class="title sectiontitle">Add availability zones</h2>
      <p class="p">When adding a new node, an additional step you'll
      need to take is to add the new node(s) to a Nova availability zone. This can be skipped if you
      have not configured any availability zones.</p>

      <ol class="ol">
        <li class="li">First get a list of availability zones to get their status:<pre class="pre codeblock">stack@padawan-ccp-c0-m1-mgmt:~$ nova availability-zone-list</pre>

          <pre class="pre codeblock">+------------------------------+----------------------------------------+
| Name                         | Status                                 |
+------------------------------+----------------------------------------+
| internal                     | available                              |
| |- padawan-ccp-c1-m1-mgmt    |                                        |
| | |- nova-conductor          | enabled :-) 2015-10-12T10:32:26.000000 |
| | |- nova-scheduler          | enabled :-) 2015-10-12T10:32:23.000000 |
| | |- nova-consoleauth        | enabled :-) 2015-10-12T10:32:25.000000 |
| |- padawan-ccp-c1-m2-mgmt    |                                        |
| | |- nova-conductor          | enabled :-) 2015-10-12T10:32:22.000000 |
| | |- nova-scheduler          | enabled :-) 2015-10-12T10:32:24.000000 |
| |- padawan-ccp-c1-m3-mgmt    |                                        |
| | |- nova-conductor          | enabled :-) 2015-10-12T10:32:24.000000 |
| | |- nova-scheduler          | enabled :-) 2015-10-12T10:32:24.000000 |
| AZ1                          | available                              |
| |- padawan-ccp-comp0001-mgmt |                                        |
| | |- nova-compute            | enabled :-) 2015-10-12T10:32:21.000000 |
| AZ3                          | available                              |
| |- padawan-ccp-comp0003-mgmt |                                        |
| | |- nova-compute            | enabled :-) 2015-10-12T10:32:21.000000 |
| nova                         | available                              |
| |- padawan-ccp-comp0002-mgmt |                                        |
| | |- nova-compute            | enabled :-) 2015-10-12T10:32:21.000000 |
+------------------------------+----------------------------------------+</pre>

        </li>

        <li class="li">Then run nova-cloud-configure.yml to update the nova availability zones and effect the
          changes you made in the previous section:<pre class="pre codeblock">stack@padawan-ccp-c0-m1-mgmt:~$ ansible-playbook -i hosts/verb_hosts nova-cloud-configure.yml</pre>

          <pre class="pre codeblock">PLAY [NOV-CLI] **************************************************************** 

GATHERING FACTS *************************************************************** 
ok: [padawan-ccp-c1-m2-mgmt]
ok: [padawan-ccp-c1-m3-mgmt]
ok: [padawan-ccp-c1-m1-mgmt]

TASK: [NOV-CLI | availability_zones | create host aggregate and az] *********** 
ok: [padawan-ccp-c1-m1-mgmt] =&gt; (item=AZ1)
ok: [padawan-ccp-c1-m1-mgmt] =&gt; (item=AZ2)
ok: [padawan-ccp-c1-m1-mgmt] =&gt; (item=AZ3)

TASK: [NOV-CLI | availability_zones | add host to az] ************************* 
ok: [padawan-ccp-c1-m1-mgmt] =&gt; (item=padawan-ccp-comp0001-mgmt)
changed: [padawan-ccp-c1-m1-mgmt] =&gt; (item=padawan-ccp-comp0002-mgmt)
ok: [padawan-ccp-c1-m1-mgmt] =&gt; (item=padawan-ccp-comp0003-mgmt)

PLAY RECAP ******************************************************************** 
NOV-CLI | availability_zones | add host to az --------------------------- 7.30s
NOV-CLI | availability_zones | create host aggregate and az ------------- 3.68s
-------------------------------------------------------------------------------
Total: ----------------------------------------------------------------- 14.10s
padawan-ccp-c1-m1-mgmt     : ok=3    changed=1    unreachable=0    failed=0   
padawan-ccp-c1-m2-mgmt     : ok=3    changed=1    unreachable=0    failed=0   
padawan-ccp-c1-m3-mgmt     : ok=3    changed=1    unreachable=0    failed=0</pre>

        </li>

        <li class="li">Get a list of availability zones again to verify that the new node is in the right
          availability zone now.<pre class="pre codeblock">stack@padawan-ccp-c0-m1-mgmt:~$ nova availability-zone-list</pre>

          <pre class="pre codeblock">+------------------------------+----------------------------------------+
| Name                         | Status                                 |
+------------------------------+----------------------------------------+
| internal                     | available                              |
| |- padawan-ccp-c1-m1-mgmt    |                                        |
| | |- nova-conductor          | enabled :-) 2015-10-12T10:34:16.000000 |
| | |- nova-scheduler          | enabled :-) 2015-10-12T10:34:13.000000 |
| | |- nova-consoleauth        | enabled :-) 2015-10-12T10:34:15.000000 |
| |- padawan-ccp-c1-m2-mgmt    |                                        |
| | |- nova-conductor          | enabled :-) 2015-10-12T10:34:12.000000 |
| | |- nova-scheduler          | enabled :-) 2015-10-12T10:34:14.000000 |
| |- padawan-ccp-c1-m3-mgmt    |                                        |
| | |- nova-conductor          | enabled :-) 2015-10-12T10:34:14.000000 |
| | |- nova-scheduler          | enabled :-) 2015-10-12T10:34:14.000000 |
| AZ1                          | available                              |
| |- padawan-ccp-comp0001-mgmt |                                        |
| | |- nova-compute            | enabled :-) 2015-10-12T10:34:11.000000 |
| AZ3                          | available                              |
| |- padawan-ccp-comp0002-mgmt |                                        |
| | |- nova-compute            | enabled :-) 2015-10-12T10:34:11.000000 |
| |- padawan-ccp-comp0003-mgmt |                                        |
| | |- nova-compute            | enabled :-) 2015-10-12T10:34:11.000000 |
+------------------------------+----------------------------------------+</pre>

        </li>

      </ol>

    </div>

    <div class="section"><h2 class="title sectiontitle">Server names and IDs</h2> The server id is a name you, the user assign to an
      entry in the servers.yml file. This entry will usually represent a physical machine and may be
      the corporate asset number for example. When the configuration processor is run against the
      servers.yml file it will generate a <strong class="ph b">server_info.yml</strong> file in
        <strong class="ph b">/helion/my_cloud/info</strong> which contains the mapping between the entry in the<strong class="ph b">
        servers.yml</strong> file and the machine entity created in your cloud as seen in the output from
      nova service-list. For example, for following entry in <strong class="ph b">servers.yml
      </strong><pre class="pre codeblock">- id: COMPUTE-0003
      ip-addr: 192.168.10.8
      role: COMPUTE-ROLE
      server-group: RACK3
      mac-addr: 22:f1:9d:ba:2c:2d
      ilo-ip: 192.168.9.8
      ilo-password: password
      ilo-user: admin
      In the server_info.yml file it is mapped to padawan-ccp-comp0003-mgmt
      COMPUTE-0003:
      failure-zone: AZ3
      hostname: padawan-ccp-comp0003-mgmt
      net_data:
      eth1:
      MANAGEMENT-NET:
      addr: 192.168.245.8
      tagged-vlan: false
      vlan-id: 102
      eth2:
      HLM-NET:
      addr: 192.168.10.8
      tagged-vlan: false
      vlan-id: 101
      eth3:
      EXTERNAL-VM-NET:
      addr: null
      tagged-vlan: true
      vlan-id: 103
      state: allocated</pre>

      So when doing a nova service-list or nova hypervisor-list you can map the hosts shown there to
      items in the servers.yml by looking for them in the server_info.yml <pre class="pre codeblock">stack@padawan-ccp-c0-m1-mgmt:~$ nova service-list</pre>

      <pre class="pre codeblock">+----+------------------+---------------------------+----------+---------+-------+----------------------------+-----------------+
      | Id | Binary           | Host                      | Zone     | Status  | State | Updated_at                 | Disabled Reason |
      +----+------------------+---------------------------+----------+---------+-------+----------------------------+-----------------+
      | 1  | nova-conductor   | padawan-ccp-c1-m1-mgmt    | internal | enabled | up    | 2015-10-26T05:23:13.000000 | -               |
      | 4  | nova-scheduler   | padawan-ccp-c1-m1-mgmt    | internal | enabled | up    | 2015-10-26T05:23:20.000000 | -               |
      | 7  | nova-conductor   | padawan-ccp-c1-m3-mgmt    | internal | enabled | up    | 2015-10-26T05:23:14.000000 | -               |
      | 13 | nova-conductor   | padawan-ccp-c1-m2-mgmt    | internal | enabled | up    | 2015-10-26T05:23:23.000000 | -               |
      | 16 | nova-scheduler   | padawan-ccp-c1-m2-mgmt    | internal | enabled | up    | 2015-10-26T05:23:20.000000 | -               |
      | 19 | nova-consoleauth | padawan-ccp-c1-m1-mgmt    | internal | enabled | up    | 2015-10-26T05:23:21.000000 | -               |
      | 22 | nova-scheduler   | padawan-ccp-c1-m3-mgmt    | internal | enabled | up    | 2015-10-26T05:23:20.000000 | -               |
      | 25 | nova-compute     | padawan-ccp-comp0002-mgmt | AZ2      | enabled | up    | 2015-10-26T05:23:15.000000 | -               |
      | 28 | nova-compute     | padawan-ccp-comp0003-mgmt | AZ3      | enabled | up    | 2015-10-26T05:23:18.000000 | -               |
      | 31 | nova-compute     | padawan-ccp-comp0001-mgmt | AZ1      | enabled | up    | 2015-10-26T05:23:17.000000 | -               |
      +----+------------------+---------------------------+----------+---------+-------+----------------------------+-----------------+
      stack@padawan-ccp-c0-m1-mgmt:~$ nova hypervisor-list
      +----+---------------------------+-------+---------+
      | ID | Hypervisor hostname       | State | Status  |
      +----+---------------------------+-------+---------+
      | 1  | padawan-ccp-comp0002-mgmt | up    | enabled |
      | 4  | padawan-ccp-comp0003-mgmt | up    | enabled |
      | 7  | padawan-ccp-comp0001-mgmt | up    | enabled |
      +----+---------------------------+-------+---------+</pre>

    </div>

  </div>

<div class="navfooter"><!----></div><div class="footer">WebHelp output generated by<a class="oxyFooter" href="http://www.oxygenxml.com" target="_blank"><span class="oXygenLogo"><img src="../../oxygen-webhelp/resources/img/LogoOxygen100x22.png" alt="Oxygen"></img></span><span class="xmlauthor">XML Author</span></a></div>
</body>
</html>