
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
<head><meta name="description" content="Default Backup and Restore As part of the installation procedure in HPE Helion OpenStack 速 2.0, automatic backup/restore jobs are uploaded from Swift into the Freezer scheduler. The backup jobs ..."></meta><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><meta name="DC.Type" content="topic"></meta><meta name="DC.Title" content="HPE Helion OpenStack 2.0: Backing up the Cloud Control Plane"></meta><meta name="prodname" content="HPE Helion"></meta><meta name="version" content="4.1.0"></meta><meta name="copyright" content="HPE Helion 2015" type="primary"></meta><meta name="DC.Rights.Owner" content="HPE Helion 2015" type="primary"></meta><meta name="DC.Format" content="XHTML"></meta><meta name="DC.Identifier" content="topic_jsc_qps_qt"></meta><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>HPE Helion OpenStack 2.0: Backing up the Cloud Control Plane</title><!--  Generated with Oxygen version 17.0, build number 2015072912.  --><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/resources/skins/skin.css"><!----></link><script type="text/javascript"><!--
          
          var prefix = "../../index.html";
          
          --></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery-1.8.2.min.js"><!----></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="topic_jsc_qps_qt">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><a href="javascript:window.print();" title="Print this page"></a></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td width="75%"></td><td><div class="navheader"></div></td></tr></tbody></table>

  <h1 class="title topictitle1">HPE Helion OpenStack<sup>速</sup> 2.0: Backing up the Cloud Control Plane </h1>

  <div class="body">
    <div class="section"><h2 class="title sectiontitle">Default Backup and Restore</h2><p class="p">As part of the installation procedure in 
      HPE Helion OpenStack<sup>速</sup> 2.0, automatic backup/restore jobs are uploaded from
        Swift into the Freezer scheduler. The backup jobs perform scheduled backups of Helion
        OpenStack control plane data (files/directories/db). The restore jobs can be used to restore
        appropriate control plane data. Additional automatic jobs can be added to backup/restore
        from the secure shell (SSH) server. You must use the following procedure to set up SSH
        backup during installation:</p>
</div>

    <div class="section"><h2 class="title sectiontitle">Setting up SSH backup</h2>
      <div class="p">By default, during HPE Helion OpenStack<sup>速</sup> 2.0 deployment, backup jobs
        are automatically deployed to Swift, the MySQL database, the deployer, and Swift rings.
        Restore jobs are also deployed for convenience. It is more secure to store those backups
        also outside of the Helion infrastructure. If you provide all the values required in the
        following file, jobs will also be deployed to backup and restore to/from an SSH server of
        your choice:<pre class="pre codeblock">~/helion/my_cloud/config/freezer/ssh_credentials.yml</pre>

      </div>
</div>

    <div class="section"><h2 class="title sectiontitle">Backing up your Helion control plane to an SSH server</h2>
      <div class="p">You must provide the following connection information to this server:<ul class="ul">
          <li class="li">The SSH server IP</li>

          <li class="li">The SSH server port to connect to (usually 22). You may want to confirm how to open
            the port on Helion's firewall.</li>

          <li class="li">The SSH server user to connect to</li>

          <li class="li">The SSH private key authorized to connect to that user (see below for details of how
            to set up one if it is not already done)</li>

          <li class="li">The directory where you wish to store the backup on that server</li>

        </ul>

      </div>

    </div>

    <div class="section"><h2 class="title sectiontitle">Setting SSH information before deployment</h2>
      <div class="p">Before running the configuration processor, edit the following file:
        <pre class="pre codeblock">~/helion/my_cloud/config/freezer/ssh_credentials.yml</pre>
Please be advised
        that all parameters are mandatory, and take care in providing the SSH private key.</div>
</div>

    <div class="section"><h2 class="title sectiontitle">Setting SSH information after deployment</h2><p class="p">If you already deployed your
        cloud and forgot to configure SSH backups, or if you wish to modify the settings for where
        the backups are stored, follow the following instructions:</p>

      <ol class="ol">
        <li class="li">Edit the following file:
          <pre class="pre codeblock">~/helion/my_cloud/config/freezer/ssh_credentials.yml</pre>
Please be
          advised that all parameters are mandatory, and take care in providing the SSH private
          key.</li>

        <li class="li">Run the following commands:
          <pre class="pre codeblock">cd ~/helion
git add -A
git commit -m "My config"
cd ~/helion/hos/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts _freezer_manage_jobs.yml</pre>
This
          will deploy the SSH key and configure SSH backup and restore jobs for you. It may take
          some time before the backups occur.</li>

      </ol>
</div>

    <div class="section"><h2 class="title sectiontitle">Preparing the server that will store the backup</h2><div class="p">In this example, the
        information is as follows: <ul class="ul">
          <li class="li">IP: 192.168.100.42</li>

          <li class="li">Port: 22</li>

          <li class="li">User: backupuser</li>

          <li class="li">Target directory for backups: /mnt/backups/</li>

        </ul>
</div>

      <p class="p">Please replace these values to meet your own requirements, as appropriate.</p>

      <ol class="ol">
        <li class="li">Connect to the server: <pre class="pre codeblock">ssh -p 22 root@192.168.100.42</pre>
</li>

        <li class="li">Create the user:
          <pre class="pre codeblock">useradd backupuser --create-home --home-dir /mnt/backups/</pre>
</li>

        <li class="li">Switch to that user:<pre class="pre codeblock">su backupuser</pre>
</li>

        <li class="li">Create the SSH keypair:
          <pre class="pre codeblock">ssh-keygen -t rsa
# Just leave the default for the first question and don't set any passphrase
&gt; Generating public/private rsa key pair.
&gt; Enter file in which to save the key (/mnt/backups//.ssh/id_rsa): 
&gt; Created directory '/mnt/backups//.ssh'.
&gt; Enter passphrase (empty for no passphrase): 
&gt; Enter same passphrase again: 
&gt; Your identification has been saved in /mnt/backups//.ssh/id_rsa
&gt; Your public key has been saved in /mnt/backups//.ssh/id_rsa.pub
&gt; The key fingerprint is:
&gt; a9:08:ae:ee:3c:57:62:31:d2:52:77:a7:4e:37:d1:28 backupuser@padawan-ccp-c0-m1-mgmt
&gt; The key's randomart image is:
&gt; +---[RSA 2048]----+
&gt; |          o      |
&gt; |   . . E + .     |
&gt; |  o . . + .      |
&gt; | o +   o +       |
&gt; |  + o o S .      |
&gt; | . + o o         |
&gt; |  o + .          |
&gt; |.o .             |
&gt; |++o              |
&gt; +-----------------+</pre>
</li>

        <li class="li">Add the public key to the list of the keys authorized to connect to that user on this
          server:
          <pre class="pre codeblock">cat /mnt/backups/.ssh/id_rsa.pub &gt;&gt; /mnt/backups/.ssh/authorized_keys</pre>
</li>

        <li class="li">Print the private key. This is what you will use for the backup configuration:
          <pre class="pre codeblock">cat /mnt/backups/.ssh/id_rsa
-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAvjwKu6f940IVGHpUj3ffl3eKXACgVr3L5s9UJnb15+zV3K5L
BZuor8MLvwtskSkgdXNrpPZhNCsWSkryJff5I335Jhr/e5o03Yy+RqIMrJAIa0X5
7b3i+hh4S9JGcuiRCLyQWayaBkES5kjSDWreya+tg32irI318L5p/O0e14APutBF
BH4vkr147Ezj4ADtnuG6iGRR4QSKZ6dpD8DsDeevwXpUbR56HEBOhz2gkKT6x/rF
Hxi6RMYWEBn+5z3pxOgpnGJLtlr2DelCqUwlLnUgHEMAen9WkhudcrwWDJS0j5XY
i8/9a9siJJwwUmgrxNYAbtNjnkGJevRwSzyp+wIDAQABAoIBAEq4rsaS78iqFjst
IbXQsgR+sdv9av1nQ4X/feA17dURU9eApnsnbxTKmfyKcjR6YQOBOJDtLbUeD31S
/tYnFrb4Ljrnc96K7aTwOXTpBe1qDcSFEexuH494uRefGojcDMvPtStj/oPiX5gQ
lmEqzyONW6xAVvtML4RGZr8wLGMcfrGsYeYpmWZ2Z0Ot7elzQeJKya5/9q2jQFRa
rKO+VzlKJY8C4H21vt38M5a+RyYH3KGhq330Irl26uC9TnSOmmY2iUCW52004xGU
Gkp8MHjjMsb/Pydaef4aBPrDUrFq2pUPklzTQJqU8AvQz3WJDv6wdMNX8FIQWuKQ
Zvye1DECgYEA3w4WkYZMaF/Ln+8w416qIvKKpuco+F39tGXQ8cJ68bphQHTemhTu
UCI4sqIHRgKoWSeKW3PM21zoblnLkNcRiWBl2D5JHIqMfrzIjzBKZ/r/F2Xz97/Y
zpkIBGwe37c8N3qKxFD1P4V/U8vCgX7FMBYBFLoSOIKiH0QYNoZ21z0CgYEA2lT7
ONPxnk4ix2fJJUmTnvXOUMca9SHyJqnqWIdDC2AaBxDa+2XUgbFcs4PQXE1Gkxen
op30P/2/f7y/sJNa6Ksl2ybsQNoYuzxKplHb8G0VsRifhq83tl6sQpjwfudH3F/d
4CKIgPCL8+QrQfeSeCzHUla6pd3wKFSfTtyF2ZcCgYAzoY0zzkRtfI8jzDgiyUzU
nhPeIm/nXcpWMaM18vCGd7//LY5BWEr5nZJGNx87422YhYCPPrTSqiTbNknakw3q
ILgyX+iIhMGUrJo4GtN+Uikt/1mDpZLH78BdVbGn00BLD0CDxMGgHISmnum9E90N
Dmrdo1yIXCSu3BJGvMVReQKBgDBwYjw9aYHBvB2ZfRr0s/e0eU2anvR7z4mccQ2r
FMjVTXD74FmeQgN0IikBuZyA2IOR3/NIMARye6YPbkfyqVyte/yfKhNJT+taeQVl
a/JvgTyFRf9PqIChiH5OCC1fiqXt7v/nKXnR5Hr7yE0ebDSVWrN94nMiRkHsZFvO
uTOJAoGAPwIJzp2oHH9ec+bfen40ecsqDAmKWf6Izxhe9YzZe4aq+3msIM49V0Bg
iBKVKGPhOnn4ve3dDqy3q7fS5sivTqCrpaYtByJmPrcJNjb2K7VMLNvgLamK/AbL
qpSTZjicKZCCl+J2+8lrKAaDWqWtIjSUs29kCL78QmaPOgEvfsw=
-----END RSA PRIVATE KEY-----</pre>
</li>

      </ol>

      <p class="p">You server is now ready to receive backups. If you wish, you can check our advice on how to
        secure it.</p>
</div>

    <div class="section"><h2 class="title sectiontitle">Opening ports in Helion's firewall </h2><p class="p"> There is a strict policy of
        firewalling deployed with HPE Helion. If you use a non-standard SSH port, you may need to
        specifically open it by using the following process:</p>

      <ol class="ol">
        <li class="li">When creating your model, edit the following
          file:<pre class="pre codeblock">~/helion/my_cloud/definition/data/firewall_rules.yml</pre>
</li>

        <li class="li">You must add a new element in the firewall-rules list, such as:
          <pre class="pre codeblock">
- name: BACKUP
  # network-groups is a list of all the network group names
  # that the rules apply to
  network-groups:
  - MANAGEMENT
  rules:
  - type: allow
    # range of remote addresses in CIDR format that this
    # rule applies to
    remote-ip-prefix:  
    port-range-min: 
    port-range-max: 
    # protocol must be one of: null, tcp, udp or icmp
    protocol: tcp</pre>
</li>

      </ol>

    </div>

    <div class="section"><h2 class="title sectiontitle">Securing your SSH backup server</h2><div class="p">You can do the following to harden an SSH server (these techniques are well documented on the internet):<ul class="ul">
          <li class="li">Disable root login</li>

          <li class="li">Move SSH to a non-default port (that is, something other than 22)</li>

          <li class="li">Disable password login (only allow RSA keys)</li>

          <li class="li">Disable SSH v1</li>

          <li class="li">Authorize Secure File Transfer Protocol (SFTP) only for that user (disable SSH
            shell)</li>

          <li class="li">Firewall SSH traffic to ensure it comes from the HPE Helion address range</li>

          <li class="li">Install a Fail2Ban solution</li>

          <li class="li">Restrict users that are allowed to SSH</li>

        </ul>
</div>
<p class="p">Remove the key pair generated earlier on the backup server: the only thing needed is the
        .ssh/authorized_keys. You can remove the .ssh/id_rsa and .ssh/id_rsa.pub files. Be sure to
        save a backup of them somewhere.</p>
</div>

    <div class="section"><h2 class="title sectiontitle">Generic tips</h2><ul class="ul">
        <li class="li">Take care when sizing the directory that will receive the backup. </li>

        <li class="li">Monitor the space left on that directory.</li>

        <li class="li">Keep the system up-to-date on that server.</li>

      </ul>
</div>

  </div>

<div class="navfooter"><!----></div><div class="footer">WebHelp output generated by<a class="oxyFooter" href="http://www.oxygenxml.com" target="_blank"><span class="oXygenLogo"><img src="../../oxygen-webhelp/resources/img/LogoOxygen100x22.png" alt="Oxygen"></img></span><span class="xmlauthor">XML Author</span></a></div>
</body>
</html>