
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
<head><meta name="description" content="Warning: If it applies to the server, do not skip step 11. If you do, the system will overwrite the existing rings with new rings. This will not cause data loss, but, potentially, will move most ..."></meta><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><meta name="DC.Type" content="topic"></meta><meta name="DC.Title" content="HPE Helion OpenStack 2.0: Replacing a Swift Node"></meta><meta name="prodname" content="HPE Helion"></meta><meta name="version" content="4.1.0"></meta><meta name="copyright" content="HPE Helion 2015" type="primary"></meta><meta name="DC.Rights.Owner" content="HPE Helion 2015" type="primary"></meta><meta name="DC.Format" content="XHTML"></meta><meta name="DC.Identifier" content="topic_r21_rpv_pt"></meta><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>HPE Helion OpenStack 2.0: Replacing a Swift Node</title><!--  Generated with Oxygen version 17.0, build number 2015072912.  --><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../../oxygen-webhelp/resources/skins/skin.css"><!----></link><script type="text/javascript"><!--
          
          var prefix = "../../index.html";
          
          --></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery-1.8.2.min.js"><!----></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="topic_r21_rpv_pt">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><a href="javascript:window.print();" title="Print this page"></a></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td width="75%"></td><td><div class="navheader"></div></td></tr></tbody></table>

  <h1 class="title topictitle1">HPE Helion OpenStack<sup>®</sup> 2.0: Replacing a Swift Node</h1>

  <div class="body">
    <div class="p"><div class="note warning"><span class="warningtitle">Warning:</span> If it applies to the server, do not skip step 11. If you do, the system
        will overwrite the existing rings with new rings. This will not cause data loss, but,
        potentially, will move most objects in your system to new locations and may make data
        unavailable until the replication process has completed. </div>
To replace a Swift node in a
      system, do the following:<ol class="ol" id="topic_r21_rpv_pt__ol_mbn_5pv_pt">
        <li class="li">Log onto the deployer/lifecycle-manager node.</li>

        <li class="li">Update the cloud model (<samp class="ph codeph">data/servers.yml</samp> file) with a new MAC address,
          iLO/IPMI user, password, and IP address (iLO) if these have changed. Do not change the
          server's IP address (i.e.,<samp class="ph codeph"> ip-add IP</samp>). For
          example:<pre class="pre codeblock"> - id: swobj5
   role: SWOBJ-ROLE
   server-group: rack2
   mac-addr: 8c:dc:d4:b5:cb:bd 
   nic-mapping: HP-DL360-6PORT
   ip-addr: 10.243.131.10
   ilo-ip: 10.1.12.88
   ilo-user: iLOuser
   ilo-password: iLOpass
  ...</pre>
</li>

        <li class="li">Commit the changes to
          Git:<pre class="pre codeblock">cd ~helion
git commit -a -m "&lt;commit message&gt;"</pre>
</li>

        <li class="li">Run the configuration
          processor:<pre class="pre codeblock">cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</pre>
</li>

        <li class="li">Create a deployment
          directory:<pre class="pre codeblock">cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml</pre>
</li>

        <li class="li">Remove the replaced Swift node from
            Cobbler:<pre class="pre codeblock">sudo cobbler system remove --name &lt;server-id&gt;</pre>
<div class="p">For
            example:<pre class="pre codeblock">sudo cobbler system remove --name swobj5</pre>
</div>
</li>

        <li class="li">Re-run the <samp class="ph codeph">cobbler-deploy.yml</samp> playbook to re-add the replaced
          node:<pre class="pre codeblock">cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/localhost cobbler-deploy.yml</pre>
</li>

        <li class="li">Using Ansible, reimage the
            node:<pre class="pre codeblock">cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=&lt;server id&gt;</pre>
<div class="p">In
            the example below, the server <strong class="ph b">swobj5</strong> is
            reimaged.<pre class="pre codeblock">cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost bm-reimage.yml -e nodelist=swobj5</pre>
</div>
</li>

        <li class="li">Review the <samp class="ph codeph">cloudConfig.yml</samp> and<samp class="ph codeph"> data/control_plane.yml</samp>
          files to get the host prefix (for example, helion) and the control plane name (for
          example, cp1). This gives you the hostname of the node. Configure the operating
            system:<pre class="pre codeblock">cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-run.yml –limit &lt;hostname&gt;</pre>
<div class="p">In
            the following example, for <strong class="ph b">swobj5</strong>, the hostname is
            <strong class="ph b">helion-cp1-swobj0005</strong>:<pre class="pre codeblock">cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts osconfig-run.yml –limit helion-cp1-swobj0005*</pre>
</div>
</li>

        <li class="li">If this is the first server running the <samp class="ph codeph">swift-proxy</samp> service, restore
          the Swift Ring Builder files to the <samp class="ph codeph">/etc/swiftlm/builder_dir</samp> directory.
          (For more information and instructions, see <a class="xref" href="first_proxy_server.html#topic_rtc_s3t_mt">HPE Helion OpenStack 2.0: Identifying the First Swift Proxy Server</a> and <a class="xref" href="recovering_builder_file.html#topic_gbz_13t_mt">HPE Helion OpenStack 2.0: Recovering Swift Builder Files</a>.)</li>

        <li class="li">Configure services on the node using the <samp class="ph codeph">site.yml</samp> playbook. If you have
          used an encryption password when running the Configuration processor, include the
            <samp class="ph codeph">--ask-vault-pass</samp>
            argument.<pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts hlm-deploy.yml --ask-vault-pass --limit &lt;hostname&gt;</pre>
<div class="p">For
            example:<pre class="pre codeblock">ansible-playbook -i hosts/verb_hosts hlm-deploy.yml --ask-vault-pass --limit helion-cp1-swobj5*</pre>
</div>
</li>

      </ol>
</div>

  </div>

<div class="navfooter"><!----></div><div class="footer">WebHelp output generated by<a class="oxyFooter" href="http://www.oxygenxml.com" target="_blank"><span class="oXygenLogo"><img src="../../oxygen-webhelp/resources/img/LogoOxygen100x22.png" alt="Oxygen"></img></span><span class="xmlauthor">XML Author</span></a></div>
</body>
</html>