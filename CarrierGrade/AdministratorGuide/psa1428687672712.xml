<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr id="psa1428687672712" xml:lang="en-us">
<!-- Modification History
        
-->
    <title >SR-IOV Ethernet Interfaces</title>
    <shortdesc >A SR-IOV Ethernet interface is a physical PCI Ethernet NIC that
        implements hardware-based virtualization mechanisms to expose multiple virtual network
        interfaces that can be used by one or more virtual machines simultaneously.</shortdesc>
    <prolog>
        <author >Pedro Sanchez</author>
    </prolog>
    <taskbody>
        <context id="context_N10022_N1001F_N10001" >
            <p >The PCI-SIG Single Root I/O Virtualization and Sharing (SR-IOV)
                specification defines a standardized mechanism to create individual virtual Ethernet
                devices from a single physical Ethernet interface. For each exposed virtual Ethernet
                device, formally referred to as a <term >Virtual Function</term>
                (VF), the SR-IOV interface provides separate management memory space, work queues,
                interrupts resources, and DMA streams, while utilizing common resources behind the
                host interface. Each VF therefore has direct access to the hardware and can be
                considered to be an independent Ethernet interface.</p>
            <p >When compared with a PCI Passthtrough Ethernet interface, a SR-IOV Ethernet
                interface:</p>
            <ul id="ul_tyq_ymg_rr">
                <li >
                    <p >Provides benefits similar to those of a PCI Passthtrough Ethernet interface,
                        including lower latency packet processing.</p>
                </li>
                <li >
                    <p >Scales up more easily in a virtualized environment by providing multiple VFs
                        that can be attached to multiple virtual machine interfaces.</p>
                </li>
                <li >
                    <p >Shares the same limitations, including the lack of support for LAG, QoS, ACS,
                        and live migration.</p>
                </li>
                <li >
                    <p >Has the same requirements regarding the VLAN configuration of
                        the access switches.</p>
                </li>
                <li >
                    <p >Provides a similar configuration workflow when used on HP Helion OpenStack Carrier Grade.</p>
                </li>
            </ul>
            <p >It is suggested that you read <xref href="psa1413402160578.xml" /> first. Most configuration steps are similar, with the
                difference that you use <codeph >pci-sriov</codeph>
                instead of <codeph >pci-passthrough</codeph> when defining
                the network type of an interface.</p>
            <p >In the following example a new virtual machine is launched by user
                    <codeph >user1</codeph> on tenant <codeph >tenant1</codeph>, with a VF interface connected to the
                tenant network <codeph >tenant1-net1</codeph> identified
                with VLAN ID 20.</p>
        </context>
        <prereq id="prereq_N10065_N10020_N10001" >
            <p >The exercise assumes that the underlying provider network
                    <codeph >group0-data0</codeph> exists already, and that
                VLAN ID 20 is a valid segmentation ID assigned to <codeph >tenant1</codeph>.</p>
        </prereq>
        <steps>
            <step id="step_N10079_N10076_N10020_N10001" >
                <cmd >Log in as the <codeph >admin</codeph>
                    user to the web management interface.</cmd>
            </step>
            <step id="step_N100BC_N100A9_N1001F_N10001" >
                <cmd >Lock the compute node you want to configure.</cmd>
            </step>
            <step id="step_N10086_N10076_N10020_N10001" >
                <cmd >Configure the Ethernet interface to be used as a SR-IOV
                    interface.</cmd>
                <info >
                    <p >Select the <wintitle >System
                            Inventory</wintitle> window from the <uicontrol >Admin</uicontrol> panel, click the <uicontrol >Hosts</uicontrol> tab, click the name of the compute node where the PCI
                        interface is available, click the <uicontrol >Interfaces</uicontrol> tab, and finally click the <uicontrol >Edit Interface</uicontrol> button associated with the
                        interface you want to configure. Fill in the window as illustrated
                        below:</p>
                    <fig id="fig_hfk_cfh_rr" >
                        <image href="psa1428767288855.image" id="image_zl3_ffh_rr"  width="4in">
                            <alt >TiS Edit SR-IOV Interface</alt>
                        </image>
                    </fig>
                    <p >In this example, Ethernet interface <codeph >eth8</codeph> is assigned the network type <term >pci-sriov</term>, enabled to use 4 VFs, and configured as connected to
                        provider network <codeph >group0-data0</codeph>.
                        Click the <uicontrol >Save</uicontrol> button to proceed.</p>
                    <p >The Maximum number of VFs displayed in this form is a read-only item which is
                        auto-discovered by the system by inspecting the specific NIC model. This
                        value is reported as 0 when the selected interface does not support
                        SR-IOV.</p>
                    <p >The interface can also be configured from the CLI as
                        illustrated below:</p>
                    <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >system host-if-modify \
-nt pci-sriov -N 4 -p group0-data0 compute-0 eth8</userinput></codeblock>
                </info>
            </step>
            <step id="step_N10080_N1007D_N1001F_N10001" >
                <cmd >Create the <codeph >tenant1-net1</codeph> tenant network.</cmd>
                <info >
                    <p >You must ensure that:</p>
                    <ul id="ul_pcn_vb4_tp">
                        <li >
                            <p >The <codeph >tenant1</codeph> tenant has access to the tenant network,
                                either assigning it as the owner, or by enabling the tenant
                                network's shared flag.</p>
                        </li>
                        <li >
                            <p >The segmentation ID is set to 20. </p>
                        </li>
                    </ul>
                </info>
            </step>
            <step id="step_N10160_N100A9_N1001F_N10001" >
                <cmd >Configure the access switch.</cmd>
                <info >
                    <p >Configure the physical port on the access switch used to
                        connect to Ethernet interface <codeph >eth8</codeph> as an access port with default VLAN ID of 20.</p>
                </info>
            </step>
            <step id="step_N10178_N100A9_N1001F_N10001" >
                <cmd >Unlock the compute node.</cmd>
            </step>
            <step id="step_N10181_N100A9_N1001F_N10001" >
                <cmd >Launch the virtual machine.</cmd>
                <substeps id="substeps_snp_klt_tp">
                    <substep >
                        <cmd >Log in as user <codeph >user1</codeph> to the web management interface.</cmd>
                    </substep>
                    <substep >
                        <cmd >Configure the network interfaces for the new virtual
                            machine.</cmd>
                        <info >
                            <p >Open the <wintitle >Launch
                                    Instance</wintitle> dialog by clicking the <uicontrol >Launch Interface</uicontrol> button on the
                                    <wintitle >Instances</wintitle> window. Configure
                                the necessary options for the new virtual machine. In particular,
                                click the <uicontrol >Networking</uicontrol> tab and
                                add a SR-IOV interface on the tenant network <codeph >tenant1-net1</codeph>, as illustrated
                                below. Add other network interfaces as needed, there are as many
                                SR-IOV ports available as VFs have been enabled.</p>
                            <fig id="fig_yxy_t1g_tp" >
                                <image href="psa1428773859042.image" id="image_g4g_b4h_rr" >
                                    <alt >TiS Assign SR-IOV interface</alt>
                                </image>
                            </fig>
                            <p >Click the <uicontrol >Launch</uicontrol> button to proceed.</p>
                            <p >SR-IOV interfaces can be attached from the CLI when
                                booting a new virtual machine, as illustrated below:</p>
                            <codeblock ><systemoutput >~(keystone_admin)$ </systemoutput><userinput >nova boot \
--nic net-id=704e9f3b,vif-model=pci-sriov my-new-vm</userinput></codeblock>
                        </info>
                    </substep>
                </substeps>
            </step>
        </steps>
        <result id="result_N101C1_N10020_N10001" >
            <p >The new virtual machine instance is up now. It has a SR-IOV VF
                connection to the <codeph >tenant1-net1</codeph> tenant
                network identified with VLAN ID 20.</p>
        </result>
    </taskbody>
</task-wr>