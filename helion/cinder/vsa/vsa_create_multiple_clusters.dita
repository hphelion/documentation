<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_q3v_krq_jt">
  <title>Modifying Cloud Model to Create Multiple Clusters</title>
  <body>
    <p>You can create multiple VSA clusters of same or different type by specifying the
      configuration in the cloud model. <note type="tip">The term <b>add</b> and <b>update</b> in
        the document means editing the respective YAML files to add or update the
            configurations/values.<p><b>Prerequisites</b></p><p>You must have three nodes per VSA
          cluster.</p></note></p>
    <section>
      <title>Cloud Configuration Changes to Create More Than One Cluster </title>
      <p>You must edit the YAML files to create more than one cluster. In this cloud configuration,
        you are adding or updating the YAML files for a same set of disk.</p>
      <p>
        <ol id="ol_szq_ltq_jt">
          <li>Add new nodes in <codeph>baremetal_config.yml</codeph> file with unique name and
              <codeph>node_id</codeph> for each cluster. <p>Example: The following
                <codeph>baremetal_config.yml</codeph> file list six nodes for two
            clusters.</p><codeblock>---
  product: 
    version: 2
  baremetal_network:
    subnet: "192.168.60.0"
    netmask: "255.255.255.0"
    gateway: "192.168.60.1"
    server_interface: "eth0"
  baremetal_servers:
 - 
      node_name: "StoreVirtual001"
      node_type: "ROLE-VSA-1"
      pxe_mac_addr: "5C:B9:01:78:2C:F8"
      pxe_interface: "eth0"
      pxe_ip_addr: "192.168.60.16"
      ilo_ip: "10.1.192.234"
      ilo_user: "Administrator"
      ilo_password: "gone2far"
    - 
      node_name: "StoreVirtual002"
      node_type: "ROLE-VSA-1"
      pxe_mac_addr: "5C:B9:01:78:9A:A0"
      pxe_interface: "eth0"
      pxe_ip_addr: "192.168.60.17"
      ilo_ip: "10.1.192.235"
      ilo_user: "Administrator"
      ilo_password: "gone2far"
    - 
      node_name: "StoreVirtual003"
      node_type: "ROLE-VSA-1"
      pxe_mac_addr: "5C:B9:01:78:8C:98"
      pxe_interface: "eth0"
      pxe_ip_addr: "192.168.60.18"
      ilo_ip: "10.1.192.237"
      ilo_user: "Administrator"
      ilo_password: "gone2far"
- 
      node_name: "StoreVirtual004"
      node_type: "ROLE-VSA-2"
      pxe_mac_addr: "5C:B9:01:78:C2:F8"
      pxe_interface: "eth0"
      pxe_ip_addr: "192.168.60.19"
      ilo_ip: "10.1.192.238"
      ilo_user: "Administrator"
      ilo_password: "gone2far"
    - 
      node_name: "StoreVirtual005"
      node_type: "ROLE-VSA-2"
      pxe_mac_addr: "5C:B9:01:78:AC:A0"
      pxe_interface: "eth0"
      pxe_ip_addr: "192.168.60.20"
      ilo_ip: "10.1.192.239"
      ilo_user: "Administrator"
      ilo_password: "gone2far"
    - 
      node_name: "StoreVirtual006"
      node_type: "ROLE-VSA-2"
      pxe_mac_addr: "5C:B9:01:78:C7:08"
      pxe_interface: "eth0"
      pxe_ip_addr: "192.168.60.21"
      ilo_ip: "10.1.192.240"
      ilo_user: "Administrator"
      ilo_password: "gone2far"</codeblock>The
            baremetal file have the following fields:<p>
              <simpletable>
                <strow>
                  <stentry><codeph>node_name</codeph></stentry>
                  <stentry>The <codeph>node_name</codeph>  must be unique and incremental. For
                    example: <b>StoreVirtual001</b>, <b>StoreVirtual002</b>, <b>StoreVirtual003</b>,
                    and so on. </stentry>
                </strow>
                <strow>
                  <stentry><codeph>node_type</codeph></stentry>
                  <stentry>The <codeph>node_type</codeph>  must be unique as it is associated with
                    roles. For example: <b>ROLE-VSA-1</b> and <b>ROLE-VSA-2</b>.</stentry>
                </strow>
              </simpletable>
            </p></li>
          <li>Add new resource-nodes in <codeph>control_plane.yml</codeph> file with name,
            resource-prefix, and server-role. <p>Example: The following
                <codeph>control_plane.yml</codeph> file contains the information of the newly added
              resource
              nodes.</p><codeblock>---
  product:
    version: 2
  
      resource-nodes:
        - name: vsacluster1
          resource-prefix: vsa1
          server-role: ROLE-VSA-1
          service-components:
            - ntp-client
            - vsa
            - freezer-agent

        - name: vsacluster2
          resource-prefix: vsa2
          server-role: ROLE-VSA-2
          service-components:
            - ntp-client
            - vsa
            - freezer-agent</codeblock><p>The
              control plane have the following fields:</p><p>
              <simpletable>
                <strow>
                  <stentry><codeph>name</codeph></stentry>
                  <stentry>This is a name assigned for the cluster. In the above example
                      <b>vsacluster1</b> and <b>vsacluster2</b>.</stentry>
                </strow>
                <strow>
                  <stentry><codeph>resource-prefix</codeph></stentry>
                  <stentry>It is the prefix of that resource cluster.</stentry>
                </strow>
                <strow>
                  <stentry><codeph>server-role</codeph></stentry>
                  <stentry>Role assigned to that cluster.</stentry>
                </strow>
              </simpletable>
            </p></li>
          <li>Update <codeph>server_roles.yml</codeph> with new VSA nodes.<p>Example: In the
              following <codeph>server_roles.yml</codeph> file new VSA nodes are added/updated.
              <codeblock>---
  product:
    version: 2

  server-roles:

    - name: ROLE-VSA-1
      interface-model: INTERFACE_SET_VSA
      disk-model: DISK_SET_VSA

    - name: ROLE-VSA-2
      interface-model: INTERFACE_SET_VSA
      disk-model: DISK_SET_VSA</codeblock></p><p>The
              server roles have the following fields:</p><p>
              <simpletable id="simpletable_ofj_mgz_jt">
                <strow>
                  <stentry><codeph>name</codeph></stentry>
                  <stentry>This is a name assigned for the cluster. In the above example
                      <b>vsacluster1</b> and <b>vsacluster2</b>.</stentry>
                </strow>
                <strow>
                  <stentry><codeph>disk-model</codeph></stentry>
                  <stentry>The type of disk available for the clusters. It can be same set of disk
                    or different set of disks. In the above example only one set of disk model is
                    shown ,i.e., <b>DISK_SET_VSA</b>.</stentry>
                </strow>
              </simpletable>
            </p></li>
          <li>Add new nodes in <codeph>servers.yml</codeph>.<p>Example: In the following
                <codeph>servers.yml</codeph> file new nodes informations are
              added.<codeblock>---
  product:
    version: 2

  servers:
    # NOTE: Addresses of servers need to be
    #       changed to match your environment.
    #
    #       Add additional servers as required
    #
    #       nic-mapping is optional.  The value specified is the name
    #       of an entry in the nic-mappings list from nic_mappings.yml.
    #       To use, uncomment and modify to match your environment.

    
    # VSA Storage Nodes
    - id: vsa1
      ip-addr: 192.168.60.16
      role: ROLE-VSA-1
    # nic-mapping: MY_2PORT_SERVER

    - id: vsa2
      ip-addr: 192.168.60.17
      role: ROLE-VSA-1
    # nic-mapping: MY_2PORT_SERVER

    - id: vsa3
      ip-addr: 192.168.60.18
      role: ROLE-VSA-1
    # nic-mapping: MY_2PORT_SERVER

    # VSA Storage Nodes
    - id: vsa4
      ip-addr: 192.168.60.19
      role: ROLE-VSA-2
    # nic-mapping: MY_2PORT_SERVER

    - id: vsa5
      ip-addr: 192.168.60.20
      role: ROLE-VSA-2
    # nic-mapping: MY_2PORT_SERVER

    - id: vsa6
      ip-addr: 192.168.60.21
      role: ROLE-VSA-2
    # nic-mapping: MY_2PORT_SERVER</codeblock></p><p>The
              servers file have the following fields:</p><p>
              <simpletable>
                <strow>
                  <stentry><codeph>id</codeph></stentry>
                  <stentry>ID of the nodes.</stentry>
                </strow>
                <strow>
                  <stentry><codeph>ip-addr</codeph></stentry>
                  <stentry>The IP address of the nodes. This IP address must be similar to the IP
                    address mentioned in the <codeph>baremetal_config.yml</codeph> file.</stentry>
                </strow>
                <strow>
                  <stentry><codeph>role</codeph></stentry>
                  <stentry>Role assigned to that cluster.</stentry>
                </strow>
              </simpletable>
            </p></li>
        </ol>
      </p>
    </section>
    <section>
      <title>Cloud Configuration Changes to Create Two Cluster with Different Set of Disks</title>
      <p>You must edit the YAML files to create more than one cluster. In this cloud configuration,
        you are adding or updating the YAML files for a different set of disks, i.e., one with
        adoptive optimization (AO) enabled and another without adoptive optimization.</p>
      <ol id="ol_ugh_z2x_jt">
        <li>Add new nodes in <codeph>baremetal_config.yml</codeph> with unique name and
            <codeph>node_id</codeph> for each cluster.</li>
        <li>Add new resource-nodes in <codeph>control_plane.yml</codeph> with name, resource-prefix,
          and server-role.</li>
        <li>Modify the <codeph>disk_set</codeph> for AO and without AO. Ensure that you use
          different files and different <codeph>disk_set</codeph>. <note>In the example file you
            will find only <codeph>disks_vsa.yml</codeph> file, which contains the information for
            both AO and without AO. You must create a separate YAML file and enter the configuration
            information of AO in that file.</note></li>
        <li>Update <codeph>server_roles.yml</codeph> with new VSA nodes and appropriate
            <codeph>disk_set</codeph> used for that node.<p>Example: In the following
              <codeph>servers_roles.yml</codeph> file you can see both AO and without AO assigned
            for the
          node.</p><codeblock>---
  product:
    version: 2

  server-roles:

    - name: ROLE-CONTROLLER
      interface-model: INTERFACE_SET_CONTROLLER
      disk-model: DISK_SET_CONTROLLER

    - name: ROLE-COMPUTE
      interface-model: INTERFACE_SET_COMPUTE
      disk-model: DISK_SET_COMPUTE

    - name: ROLE-VSA-1
      interface-model: INTERFACE_SET_VSA
      disk-model: DISK_SET_VSA

    - name: ROLE-VSA-2
      interface-model: INTERFACE_SET_VSA
      disk-model: DISK_SET_VSA_AO</codeblock></li>
        <li>Add new nodes in <codeph>servers.yml</codeph>.<p>
            <note>If you have configured your cloud to have more than one cluster or n-clusters then
              remember to note down all the cluster IPs.</note>
          </p></li>
      </ol>
    </section>
  </body>
</topic>
