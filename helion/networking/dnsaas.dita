<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="HP2.0DNSaaS">
  <title>HPE Helion <tm tmtype="reg">OpenStack</tm> 2.0: DNSaaS Installation and Configuration</title>
  <body>
    <p><b>This document describes the installation process for HPE Helion OpenStack 2.0</b></p>
    <p>Our managed DNS service, based on the OpenStack Designate project, is engineered to help you
      create, publish, and manage your DNS zones and records securely and efficiently to either a
      public or private DNS server network.</p>
    <p>It is important to read through this page before starting your installation as it explains
      how to install and configure DNS as a service (DNSaaS) for HPE Helion OpenStack</p>
    
    <section id="LinkList">
      <ul>
        <li><xref type="section" href="#HP2.0DNSaaS/Prerequisites">Prerequisites</xref></li>
        <li><xref type="section" href="#HP2.0DNSaaS/PrerequisitesCredentials">Creating Prerequisites Credentials</xref></li>
        <li><xref type="section" href="#HP2.0DNSaaS/CredentialsFile">DNSaaS User and Project Credentials</xref></li>
        <li><xref type="section" href="#HP2.0DNSaaS/PreparingTheDeplopyer">Prepare the Deployer VM</xref>
          <ul>
            <li><xref href="#HP2.0DNSaaS/PrepareDeployer">Preparing to boot the Deployer
              VM</xref></li>
            <li><xref href="#HP2.0DNSaaS/BootDeployer">Booting the Deployer VM and Uploading the Deployer Tarball</xref></li>
            <li><xref href="#HP2.0DNSaaS/LoginDeployer">Login and Initialize the Deployer VM</xref></li>
          </ul>
        </li>
        <li><xref type="section" href="#HP2.0DNSaaS/PrepareDeplopyment">Prepare the Deployment</xref>
          <ul>
            <li><xref href="#HP2.0DNSaaS/ExampleDeployment">Select an Example Deployment Model</xref></li>
            <li><xref href="#HP2.0DNSaaS/CustomizeExample">Customize the Example Deployment Model</xref></li>
            <li><xref href="#HP2.0DNSaaS/RunPreInstallPlaybook">Run the Pre-Installation Playbook</xref></li>
            <li><xref href="#HP2.0DNSaaS/RunConfigProcessor">Run the Configuration Processor</xref></li>
            <li><xref href="#HP2.0DNSaaS/RunReadyDeploymentPlay">Run the Ready Deployment Playbook</xref></li>
          </ul>
        </li>
        <li><xref type="section" href="#HP2.0DNSaaS/PerformDeployment">Perform the Deployment</xref>
          <ul>
            <li><xref href="#HP2.0DNSaaS/RunBootInfrastructure">Run the Boot Infrastructure Playbook</xref></li>
            <li><xref href="#HP2.0DNSaaS/RunSitePlay">Run the Site Playbook</xref></li>
          </ul>
        </li>
      </ul>
    </section>
    
    <section id="Prerequisites">
      <title>Prerequisites</title>
      <ul>
        <li>HPE Helion Openstack 2.0 Installation</li>
        <li>Download the <xref scope="external" format="html" href="http://pinafore.usa.hp.com/paas-2.0/dnsaas-2.0/QA1/">DNSaaS Deployer Tarball</xref></li>
        <li>Download the <xref scope="external" format="html" href="http://pinafore.usa.hp.com/paas-2.0/dnsaas-2.0/QA1/">DNSaaS Cloud Image</xref></li>
        <li>Credentials of the user+tenant where the service is to be deployed ("Target Credentials")</li>
        <li>The SVC network correctly configured within HOS</li>
        <li>A SSH public and private keypair</li>
        <li>"openrc" credentials file for the Target user and project</li>
        <li>NTP Server Addresses</li>
      </ul>
    </section>
    
    <section id="PrerequisiteCredentials">
      <title>Creating the Prerequisite Credentials</title>
      <p>Target credentials are the credentials of the user+tenant where the service is to 
        be deployed. Target credentials include a tenant and a username. Service credentials 
        can only be created after the Target credentials have been successfully created.
      </p>
      <codeblock>$ source keystone.osrc 
$ openstack project create dnsaas
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description |                                  |
| domain_id   | default                          |
| enabled     | True                             |
| id          | a6c8339e816c4f4fb9118b31e2e101ad |
| name        | dnsaas                           |
+-------------+----------------------------------+
        
$ openstack user create dnsaas --password password --email dnsaas@example.com --project dnsaas
+--------------------+----------------------------------+
| Field              | Value                            |
+--------------------+----------------------------------+
| default_project_id | a6c8339e816c4f4fb9118b31e2e101ad |
| domain_id          | default                          |
| email              | dnsaas@example.com               |
| enabled            | True                             |
| id                 | 80cbe47e368b429f84cd482ba605da9f |
| name               | dnsaas                           |
+--------------------+----------------------------------+
        
$ openstack role add --project dnsaas --user dnsaas _member_
$ openstack role add --project dnsaas --user dnsaas admin
        
$ openstack role list 
+----------------------------------+-----------------+
| ID                               | Name            |
+----------------------------------+-----------------+
| 0844fbba66384e1b94760811ff142dfe | ResellerAdmin   |
| 3f6cce1607e94b73a8c6d18b23172c12 | monasca-user    |
| 4131208c90994e3e8bd11fd6f09b005f | swiftoperator   |
| 4c6a50ff78d54814a991c2fa091557d4 | monasca-agent   |
| 74dbe96963e9422ca68b6038f85f0c86 | admin           |
| 9459379fa034456c9ffc7960ee6292b9 | Member          |
| 9fe2ff9ee4384b1894a90878d3e92bab | _member_        |
| acd73916a67c48eaac85508abcfa8f97 | heat_stack_user |
| c6a1bdf905ef4ac399e4a9d5f53f6c5f | KeystoneAdmin   |
+----------------------------------+-----------------+
        
$ openstack role assignment list --user dnsaas --project dnsaas
+----------------------------------+----------------------------------+-------+----------------------------------+--------+
| Role                             | User                             | Group | Project                          | Domain |
+----------------------------------+----------------------------------+-------+----------------------------------+--------+
| 74dbe96963e9422ca68b6038f85f0c86 | 80cbe47e368b429f84cd482ba605da9f |       | a6c8339e816c4f4fb9118b31e2e101ad |        |
| 9fe2ff9ee4384b1894a90878d3e92bab | 80cbe47e368b429f84cd482ba605da9f |       | a6c8339e816c4f4fb9118b31e2e101ad |        |
+----------------------------------+----------------------------------+-------+----------------------------------+--------+       
      </codeblock>
    </section>
    
    <section id="CredentialsFile">
      <title>DNSaaS User and Project Credentials</title>
      <p>Prepare the credentials files for the DNSaaS user and project.</p>
      <codeblock>$ cat &lt;&lt;EOF &gt; dnsaas.osrc
unset OS_DOMAIN_NAME
export OS_IDENTITY_API_VERSION=3
export OS_AUTH_VERSION=3
export OS_PROJECT_DOMAIN_NAME=Default
export OS_USER_DOMAIN_NAME=Default
export OS_ENDPOINT_TYPE=internalURL
export OS_INTERFACE=internal
export OS_CACERT=/etc/ssl/certs/ca-certificates.crt
export OS_PROJECT_NAME=dnsaas
export OS_USERNAME=dnsaas
export OS_PASSWORD=password
export OS_AUTH_URL=http://192.168.245.5:35357/v3
EOF
      </codeblock>
    </section>
    
    <section id="PreparingTheDeployer">
      <title>Prepare the Deployer VM</title>
      
      <sectiondiv>
        <p id="PrepareDeployer"><b>Preparing to boot the Deployer VM</b></p>
        <p>You must publish the DNSaaS Cloud Image to the target project/tenant before proceeding to the
        next step.</p>
        <codeblock>$ source dnsaas.osrc
$ glance image-create --name "dnsaas-2.0.0-b.1_cloud-1.0.20151005T152959Z" \
          --file "dnsaas-2.0.0-b.1_cloud-1.0.20151005T152959Z.qcow2" \
          --is-public False \
          --disk-format qcow2 \
          --container-format bare
          
+------------------+---------------------------------------------+
| Property         | Value                                       |
+------------------+---------------------------------------------+
| checksum         | 48a0ae226bc0f64396c4c959b1853b75            |
| container_format | bare                                        |
| created_at       | 2015-10-06T12:45:13Z                        |
| disk_format      | qcow2                                       |
| id               | 1b9ea18d-26e4-4933-9a3d-4f43ea283302        |
| min_disk         | 0                                           |
| min_ram          | 0                                           |
| name             | dnsaas-2.0.0-b.1_cloud-1.0.20151005T152959Z |
| owner            | 6bf759ff44f948e597c9d77a44ce4ba8            |
| protected        | False                                       |
| size             | 417106432                                   |
| status           | active                                      |
| tags             | []                                          |
| updated_at       | 2015-10-06T12:45:22Z                        |
| virtual_size     | None                                        |
| visibility       | private                                     |
+------------------+---------------------------------------------+
        </codeblock>
        <p>Identify the SVC network ID.</p>
        <codeblock>$ neutron net-show SVC
+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | True                                 |
| id                        | eb9834e4-f25a-49dc-b0d4-1f140dbda7af |
| mtu                       | 0                                    |
| name                      | SVC                                  |
| provider:network_type     | flat                                 |
| provider:physical_network | physnet1                             |
| provider:segmentation_id  |                                      |
| router:external           | False                                |
| shared                    | False                                |
| status                    | ACTIVE                               |
| subnets                   | 8e2b7b15-483b-46d5-b619-3b5a59843236 |
| tenant_id                 | 6bf759ff44f948e597c9d77a44ce4ba8     |
+---------------------------+--------------------------------------+
        </codeblock>
        <p>Upload the SSH keypair.</p>
        <codeblock>$ nova keypair-add --pub-key dns_shared.pub dns-shared
$ nova keypair-show dns-shared
+-------------+-------------------------------------------------+
| Property    | Value                                           |
+-------------+-------------------------------------------------+
| created_at  | 2015-10-06T12:52:20.000000                      |
| deleted     | False                                           |
| deleted_at  | -                                               |
| fingerprint | ef:73:f7:02:40:ec:be:5e:df:c6:8d:7e:32:52:5e:c9 |
| id          | 11                                              |
| name        | dns-shared                                      |
| updated_at  | -                                               |
| user_id     | 80cbe47e368b429f84cd482ba605da9f                |
+-------------+-------------------------------------------------+
Public key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC+MaIRMRXAo8e7B80+q8FFmrNqAGYapROYVi4XGmWK+dfTad9MkCyQHDrodPwcdok4J9Ma6JmFUnh6JwcX9/kGE5y41UYuEfIuG8pAcVo2WeZr4Tq/38sC/0ZFvpqiw9QifspJE6TC80Blzz/8L/iIozANxqS7tHjKHERzvkh/Dozp/mpEY9hcHU53M/WWJZinzww7YlJVLYPEyrqZh/L3g47Ss1EI1jC4LR2FJFVa7hE0Hsv9cJ9vFkhapDFViotbpLnlCVZp+2cMr72qhuBRhcKQ2wP21+jH/E+fpEtLl48ui24kXIflRT2XI/hZpiBwbWR6uxo1DsuPnLGCT1y5 DNS Shared
        </codeblock>
        <p>Ensure the default security group is correctly configured.</p>
        <codeblock>$ neutron security-group-list --tenant-id a6c8339e816c4f4fb9118b31e2e101ad
+--------------------------------------+---------+----------------------------------------------------------------------+
| id                                   | name    | security_group_rules                                                 |
+--------------------------------------+---------+----------------------------------------------------------------------+
| d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96 | default | egress, IPv4                                                         |
|                                      |         | egress, IPv6                                                         |
|                                      |         | ingress, IPv4, remote_group_id: d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96 |
|                                      |         | ingress, IPv6, remote_group_id: d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96 |
+--------------------------------------+---------+----------------------------------------------------------------------+
          
          
$ neutron security-group-rule-create \
          --tenant-id 6bf759ff44f948e597c9d77a44ce4ba8 \
          --protocol TCP \
          --remote-ip-prefix 0.0.0.0/0 \
          --port-range-min 22 \
          --port-range-max 22 \
          d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96
          
Created a new security_group_rule:
+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| id                | e6bfc201-739d-4c77-a20f-400d8c9d3c60 |
| port_range_max    | 22                                   |
| port_range_min    | 22                                   |
| protocol          | tcp                                  |
| remote_group_id   |                                      |
| remote_ip_prefix  | 0.0.0.0/0                            |
| security_group_id | d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96 |
| tenant_id         | 6bf759ff44f948e597c9d77a44ce4ba8     |
+-------------------+--------------------------------------+
          
          
$ neutron security-group-rule-create \
          --tenant-id a6c8339e816c4f4fb9118b31e2e101ad \
          --protocol TCP \
          --remote-ip-prefix 0.0.0.0/0 \
          --port-range-min 79 \
          --port-range-max 79 \
          d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96
          
Created a new security_group_rule:
+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| id                | cc4a3854-440b-472f-a70f-6c6b645c73df |
| port_range_max    | 79                                   |
| port_range_min    | 79                                   |
| protocol          | tcp                                  |
| remote_group_id   |                                      |
| remote_ip_prefix  | 0.0.0.0/0                            |
| security_group_id | d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96 |
| tenant_id         | a6c8339e816c4f4fb9118b31e2e101ad     |
+-------------------+--------------------------------------+
          
          
$ neutron security-group-list --tenant-id a6c8339e816c4f4fb9118b31e2e101ad
+--------------------------------------+---------+----------------------------------------------------------------------+
| id                                   | name    | security_group_rules                                                 |
+--------------------------------------+---------+----------------------------------------------------------------------+
| d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96 | default | egress, IPv4                                                         |
|                                      |         | egress, IPv6                                                         |
|                                      |         | ingress, IPv4, 22/tcp, remote_ip_prefix: 0.0.0.0/0                   |
|                                      |         | ingress, IPv4, 79/tcp, remote_ip_prefix: 0.0.0.0/0                   |
|                                      |         | ingress, IPv4, remote_group_id: d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96 |
|                                      |         | ingress, IPv6, remote_group_id: d7fe914e-9f4e-48e1-8e11-f08b8b5ddf96 |
+--------------------------------------+---------+----------------------------------------------------------------------+ 
        </codeblock>
      </sectiondiv>
      
      <sectiondiv>
        <p id="BootDeployer"><b>Booting the Deployer VM and Uploading the Deployer Tarball</b></p>
        <p>Boot the Deployer VM.</p>
        <codeblock>$ nova boot --poll \
          --nic net-id=eb9834e4-f25a-49dc-b0d4-1f140dbda7af \   # SVC Network ID
          --image 1b9ea18d-26e4-4933-9a3d-4f43ea283302 \        # DNSaaS Cloud Image ID
          --key-name dns-shared \                               # Keypair Name
          --flavor m1.small \
          dnsaas-deployer
          
+--------------------------------------+------------------------------------------------------------------------------------+
| Property                             | Value                                                                              |
+--------------------------------------+------------------------------------------------------------------------------------+
| OS-EXT-AZ:availability_zone          | nova                                                                               |
| OS-EXT-SRV-ATTR:host                 | -                                                                                  |
| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                                                  |
| OS-EXT-SRV-ATTR:instance_name        | instance-00000013                                                                  |
| OS-EXT-STS:power_state               | 0                                                                                  |
| OS-EXT-STS:task_state                | scheduling                                                                         |
| OS-EXT-STS:vm_state                  | building                                                                           |
| OS-SRV-USG:launched_at               | -                                                                                  |
| OS-SRV-USG:terminated_at             | -                                                                                  |
| accessIPv4                           |                                                                                    |
| accessIPv6                           |                                                                                    |
| adminPass                            | hv7kJYS9mBXa                                                                       |
| config_drive                         |                                                                                    |
| created                              | 2015-10-06T13:12:58Z                                                               |
| flavor                               | m1.small (2)                                                                       |
| hostId                               |                                                                                    |
| id                                   | 5a255487-b816-473e-abb3-0ae96816a16c                                               |
| image                                | dnsaas-2.0.0-b.1_cloud-1.0.20151005T152959Z (1b9ea18d-26e4-4933-9a3d-4f43ea283302) |
| key_name                             | dns-shared                                                                         |
| metadata                             | {}                                                                                 |
| name                                 | dnsaas-deployer                                                                    |
| os-extended-volumes:volumes_attached | []                                                                                 |
| progress                             | 0                                                                                  |
| security_groups                      | default                                                                            |
| status                               | BUILD                                                                              |
| tenant_id                            | a6c8339e816c4f4fb9118b31e2e101ad                                                   |
| updated                              | 2015-10-06T13:12:58Z                                                               |
| user_id                              | 80cbe47e368b429f84cd482ba605da9f                                                   |
+--------------------------------------+------------------------------------------------------------------------------------+
Server building... 100% complete
Finished
          
$ nova show dnsaas-deployer
+--------------------------------------+------------------------------------------------------------------------------------+
| Property                             | Value                                                                              |
+--------------------------------------+------------------------------------------------------------------------------------+
| OS-EXT-AZ:availability_zone          | nova                                                                               |
| OS-EXT-SRV-ATTR:host                 | deployerincloud-ccp-compute0001-mgmt                                               |
| OS-EXT-SRV-ATTR:hypervisor_hostname  | deployerincloud-ccp-compute0001-mgmt                                               |
| OS-EXT-SRV-ATTR:instance_name        | instance-00000013                                                                  |
| OS-EXT-STS:power_state               | 1                                                                                  |
| OS-EXT-STS:task_state                | -                                                                                  |
| OS-EXT-STS:vm_state                  | active                                                                             |
| OS-SRV-USG:launched_at               | 2015-10-06T13:13:57.000000                                                         |
| OS-SRV-USG:terminated_at             | -                                                                                  |
| SVC network                          | 192.168.245.125                                                                    |
| accessIPv4                           |                                                                                    |
| accessIPv6                           |                                                                                    |
| config_drive                         |                                                                                    |
| created                              | 2015-10-06T13:12:58Z                                                               |
| flavor                               | m1.small (2)                                                                       |
| hostId                               | a13c39240cb16d20042350b5f988a014a02d7858fbb89d62daf99572                           |
| id                                   | 5a255487-b816-473e-abb3-0ae96816a16c                                               |
| image                                | dnsaas-2.0.0-b.1_cloud-1.0.20151005T152959Z (1b9ea18d-26e4-4933-9a3d-4f43ea283302) |
| key_name                             | dns-shared                                                                         |
| metadata                             | {}                                                                                 |
| name                                 | dnsaas-deployer                                                                    |
| os-extended-volumes:volumes_attached | []                                                                                 |
| progress                             | 0                                                                                  |
| security_groups                      | default                                                                            |
| status                               | ACTIVE                                                                             |
| tenant_id                            | a6c8339e816c4f4fb9118b31e2e101ad                                                   |
| updated                              | 2015-10-06T13:13:57Z                                                               |
| user_id                              | 80cbe47e368b429f84cd482ba605da9f                                                   |
+--------------------------------------+------------------------------------------------------------------------------------+
          
$ scp -i dns_shared dnsaas-2.0.0-b.1-20151005T183829Z.tgz stack@192.168.245.125:~
dnsaas-2.0.0-b.1-20151005T183829Z.tgz                                                           100%  273MB  91.0MB/s   00:03
        </codeblock>
      </sectiondiv>
      
      <sectiondiv>
        <p id="LoginDeployer"><b>Login and Initialize the Deployer VM</b></p>
        <codeblock>$ ssh -i dns_shared stack@192.168.245.125
The programs included with the hLinux system are free software; the exact
license terms for each program are described in the individual files in
/usr/share/doc/*/copyright.
hLinux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.
          
$ ls
dnsaas-2.0.0-b.1-20151005T183829Z.tar
$ tar xf dnsaas-2.0.0-b.1-20151005T183829Z.tar
          
$ ls
dnsaas-2.0.0-b.1  dnsaas-2.0.0-b.1-20151005T183829Z.tar
$ cd dnsaas-2.0.0-b.1/
$ ./dnsaas-init.bash 
          
[ OUTPUT TRIMMED ]
          
+ ssh-keygen -q -t rsa -f id_rsa
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
          
[ OUTPUT TRIMMED ]
          
To continue installation copy your cloud layout to:
/home/stack/helion/my_cloud/definition
Then execute the installation playbooks:
cd /home/stack/helion/hos/ansible
git add -A
git commit -m 'My config'
ansible-playbook -i hosts/localhost cobbler-deploy.yml
ansible-playbook -i hosts/localhost bm-reimage.yml
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml
cd /home/stack/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts site.yml
        </codeblock>    
      </sectiondiv>  
    </section>
    
    <section id="PrepareDeployment">
      <title>Prepare the Deployment</title>
      
      <sectiondiv>
        <p id="ExampleDeployment"><b>Select an Example Deployment Model</b></p>
        <p>HPE Helion OpenStack DNSaaS has several example models that can be deployed.  
          In the following example, the <i>powerdns</i> example deployment model is used.</p>
        <note type="important">The <codeph>cp</codeph> command must be used exactly as 
          shown - including the /* on the end of the example model path.</note>
        <codeblock>$ cd ~/helion
$ cp -r examples/powerdns/* my_cloud/definition/
$ git add -A
$ git commit -a -m "Add DNSaaS Example Model"
[site aa285cf] Add DNSaaS Example Model
12 files changed, 246 insertions(+), 3 deletions(-)
create mode 100644 my_cloud/definition/data/pass-through/dnsaas.yml
create mode 100644 my_cloud/definition/data/pass-through/hos.yml
create mode 100644 my_cloud/definition/data/baremetalConfig.yml
create mode 100644 my_cloud/definition/data/control_plane.yml
create mode 100644 my_cloud/definition/data/disks_controller.yml
create mode 100644 my_cloud/definition/data/interfaces_controller.yml
create mode 100644 my_cloud/definition/data/net_global.yml
create mode 100644 my_cloud/definition/data/network_groups.yml
create mode 100644 my_cloud/definition/data/server_roles.yml
create mode 100644 my_cloud/definition/data/servers.yml
        </codeblock>
      </sectiondiv>
      
      <sectiondiv>
        <p id="CustomizeExample"><b>Customize the Example Deployment Model</b></p>
        <p>You will need to populate the
            <codeph>~/helion/my_cloud/definition/data/pass-through/hos.yml</codeph> file with the
          appropriate URLs for your deployment. You can find the URLs in the service catalog
            <codeph>openstack catalog list</codeph> and the Keystone admin token in
            <codeph>/etc/keystone/keystone.conf</codeph> on one of the HPE Helion OpenStack control
          plane nodes. Other values may be left invalid, they will not prevent the deployment from
          completing.</p>
        <codeblock>$ cd my_cloud/definition/
$ ls
cloudConfig.yml  config  data
$ nano cloudConfig.yml
          
[ Please fill in appropriate DNS and NTP servers and save ]
          
$ cd data/pass-through/
$ ls
dnsaas.yml  hos.yml
$ nano hos.yml
          
[ Please fill in appropriate values and save ]
[ NOTE: On this HOS deployer, execute: 
          
  cd ~/scratch/ansible/next/hos/ansible
  ansible-playbook -i hosts/verb_hosts platform-paas-through.yml  -e pass_through_key=""
          
  and copy the contents of /home/stack/platform-paas-through.yml into hos.yml ]
  
$ cd ~/helion
$ git commit -a -m "Configured Deployment Model"
[site 19b2f88] Configured Deployment Model
2 files changed, 13 insertions(+), 7 deletions(-)
        </codeblock>  
      </sectiondiv>
      
      <sectiondiv>
        <p id="RunPreInstallPlaybook"><b>Run the Pre-Installation Playbook</b></p>
        <p>At the end of each playbook, ensure both "unreachable" and "failed" are zero.</p>
        <codeblock>$ source ~/dnsaas.osrc
$ cd ~/helion/hos/ansible/
$ ansible-playbook -i hosts/localhost hlm-pre-install.yml
          
[ OUTPUT TRIMMED ]
          
PLAY RECAP ********************************************************************
openstack-operations | lookup-keystone-ids | Lookup Project ID ---------- 3.49s
openstack-operations | preinstall | Ensure External Network Exists ------ 3.36s
openstack-operations | preinstall | Ensure SVC Network Exists ----------- 3.25s
openstack-operations | preinstall | Create Floating IPs necessary for load-balancers --- 2.15s
openstack-operations | preinstall | Set Neutron Quotas ------------------ 2.03s
openstack-operations | preinstall | Identify pre-existing ports --------- 2.02s
openstack-operations | preinstall | Identify pre-existing floating IPs --- 1.99s
openstack-operations | preinstall | Set Nova Quotas --------------------- 1.66s
openstack-operations | preinstall | Set Cinder Quotas ------------------- 1.63s
openstack-operations | preinstall | Write new port details to servers.yml --- 0.22s
-------------------------------------------------------------------------------
Total: ----------------------------------------------------------------- 23.01s
localhost                  : ok=19   changed=12   unreachable=0    failed=0   
        </codeblock>
      </sectiondiv>
      
      <sectiondiv>
        <p id="RunConfigProcessor"><b>Run the Configuration Processor</b></p>
        <p>At the end of each playbook, ensure both "unreachable" and "failed" are zero.</p>
        <codeblock>$ ansible-playbook -i hosts/localhost config-processor-run.yml
          
[ When asked for a encryption key - simply leave the value blank, pressing enter 4 times to proceed ]
          
[ OUTPUT TRIMMED ]
          
PLAY RECAP ******************************************************************** 
config-processor | run-config-processor | Run Configuration Processor over the given cloud configuration --- 2.44s
git-operations | _assemble-working-directory | Assemble scratch content --- 0.76s
git-operations | _persist-to-git | Prep new commit ---------------------- 0.69s
config-processor | configure | Sync ansible vars for cloud deployment --- 0.67s
config-processor | add-localhost | Add localhost group entry ------------ 0.55s
config-processor | configure | Make directories required for osconfig network configuration --- 0.33s
config-processor | configure | Sync generated network artefacts for cloud deployment/update --- 0.32s
config-processor | configure | Copy hosts.hf for osconfig playbooks ----- 0.28s
config-processor | configure | Copy ansible hosts file for cloud deployment (verb_hosts) --- 0.28s
config-processor | add-localhost | Add localhost group ------------------ 0.17s
-------------------------------------------------------------------------------
Total: ------------------------------------------------------------------ 7.99s
localhost                  : ok=21   changed=14   unreachable=0    failed=0   
        </codeblock>
      </sectiondiv>
      
      <sectiondiv>
        <p id="RunReadyDeploymentPlay"><b>Run the Ready Deployment Playbook</b></p>
        <p>At the end of each playbook, ensure both "unreachable" and "failed" are zero.</p>
        <codeblock>$ ansible-playbook -i hosts/localhost ready-deployment.yml
          
[ OUTPUT TRIMMED ]
          
TASK: [git-operations | ready-deployment-tree-help | Tell the user what to expect] *** 
ok: [localhost] => {
"msg": "The directory /home/stack/scratch/ansible/next/hos/ansible contains a prepared ansible tree ready to run your deployment. You should cd into that directory and run: ansible-playbook -i hosts/verb_hosts site.yml"
}
PLAY RECAP ******************************************************************** 
git-operations | _assemble-working-directory | Assemble scratch content --- 0.73s
config-processor | configure | Sync ansible vars for cloud deployment --- 0.54s
config-processor | configure | Sync ansible vars for cloud deployment --- 0.49s
git-operations | _promote-from-staging | Update branches ---------------- 0.41s
config-processor | configure | Make directories required for osconfig network configuration --- 0.30s
config-processor | configure | Make directories required for osconfig network configuration --- 0.27s
config-processor | configure | Sync generated network artefacts for cloud deployment/update --- 0.26s
config-processor | configure | Sync generated network artefacts for cloud deployment/update --- 0.25s
config-processor | configure | Copy ansible hosts file for cloud deployment (verb_hosts) --- 0.24s
config-processor | configure | Copy hosts.hf for osconfig playbooks ----- 0.22s
-------------------------------------------------------------------------------
Total: ------------------------------------------------------------------ 5.96s
localhost                  : ok=20   changed=11   unreachable=0    failed=0   
        </codeblock>
      </sectiondiv>
    </section>
    
    <section id="PerformDeployment">
      <title>Perform the Deployment</title>
      
      <sectiondiv>
        <p id="RunBootInfrastructure"><b>Run the Boot Infrastructure Playbook</b></p>
        <p>Once this is complete, all in-cloud infrastructure (VMs, Networks, Routers, Floating 
          IPs etc) will have been created.</p>
        <note>This step takes approximately 15 minutes to run.</note>
        <codeblock>$ cd ~/scratch/ansible/next/hos/ansible
          
# Multiple control plane nodes
$ ansible-playbook -i hosts/localhost hlm-boot-infra.yml
          
# Single control plane
$ ansible-playbook -i hosts/localhost hlm-boot-infra.yml -e neutron_router_ha=False
          
[ OUTPUT TRIMMED ]
         
PLAY RECAP ******************************************************************** 
openstack-operations | create_instance | Create controlplane instance - 176.35s
openstack-operations | create_instance | Wait for SSH to become active -- 34.36s
openstack-operations | create_instance | Extract port-id --------------- 10.54s
openstack-operations | create_port | Update ports to include appropriate security group(s) --- 8.93s
openstack-operations | create_security_groups | Create security groups rules --- 8.14s
openstack-operations | create_port | Create instance ports -------------- 5.65s
openstack-operations | create_port | Associate VIP to instance ports ---- 4.00s
openstack-operations | create_port | Create VIP ports ------------------- 3.86s
openstack-operations | lookup-keystone-ids | Lookup Project ID ---------- 3.34s
openstack-operations | create_security_groups | Create security groups --- 2.47s
-------------------------------------------------------------------------------
Total: ---------------------------------------------------------------- 280.09s
localhost                  : ok=28   changed=18   unreachable=0    failed=0
        </codeblock>
      </sectiondiv>
      
      <sectiondiv>
        <p id="RunSitePlay"><b>Run the Site Playbook</b></p>
        <note type="caution">Unlike all the previous ansible play's, the inventory file 
          supplied to this play is <b>hosts/verb_hosts</b> and not <b>hosts/localhost</b>.</note>
        <note>This step take approximately 15 to 20 minutes to complete.</note>
        <codeblock>$ ansible-playbook -i hosts/verb_hosts site.yml
          
[ OUTPUT TRIMMED ]
          
PLAY RECAP ******************************************************************** 
FND-MDB | start | Start MySQL ------------------------------------------ 85.62s
FND-MDB | install | Install MDB packages ------------------------------- 75.00s
rabbitmq | install | Install rabbitmq application ---------------------- 20.34s
rabbitmq | install | Install rabbitmq application ---------------------- 20.28s
rabbitmq | install | Install rabbitmq application ---------------------- 19.75s
DES-PDN | install | Install Power DNS packages ------------------------- 17.48s
FND-MDB | configure | Bootstrap MDB Master ----------------------------- 11.26s
logging-producer | configure | Setup config files for services that have subscribed for logging -- 10.87s
logging-producer | configure | Include default log files for centralized logging --- 9.83s
Install keepalived package ---------------------------------------------- 9.21s
-------------------------------------------------------------------------------
Total: ---------------------------------------------------------------- 611.95s
dnsaas-dnsaas-ccp-c1-m1-mgmt : ok=377  changed=190  unreachable=0    failed=0   
dnsaas-dnsaas-ccp-c1-m2-mgmt : ok=381  changed=194  unreachable=0    failed=0   
dnsaas-dnsaas-ccp-c1-m3-mgmt : ok=382  changed=196  unreachable=0    failed=0   
localhost                  : ok=34   changed=15   unreachable=0    failed=0    
        </codeblock>
      </sectiondiv>
    </section>
    
  </body>
</topic>
